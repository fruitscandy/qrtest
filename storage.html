<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Storage Iframe Echo Server</title>
<style>body{font:14px/1.4 monospace}pre{white-space:pre-wrap}</style>
</head>
<body>
<h2>ğŸ“¦ Storage Iframe â€“ Message Echo</h2>
<p>ìˆ˜ì‹ í•œ ë©”ì‹œì§€ì™€ ë°œì‹  origin ëª©ë¡ì´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
<pre id="log"></pre>

<script>
const $log = document.getElementById('log');
const origins = new Set();

/** í™”ë©´ì— ë¡œê·¸ ë‚¨ê¸°ê¸° + ìë™ ìŠ¤í¬ë¡¤ */
function log(line) {
  $log.textContent += line + '\n';
  $log.scrollTop = $log.scrollHeight;
}

/** ë©”ì‹œì§€ ìˆ˜ì‹  */
window.addEventListener('message', e => {
  const { origin, data, source } = e;
  origins.add(origin);

  log(`â–¶ ë°›ìŒ from ${origin}\n  data: ${JSON.stringify(data)}`);

  /* ë°œì‹ ìì—ê²Œ ì—ì½” ì‘ë‹µ */
  source?.postMessage(
    { received: true, echo: data, yourOrigin: origin, allOrigins: [...origins] },
    origin                      // **ë°˜ë“œì‹œ ì •í™•í•œ originìœ¼ë¡œ í•œì •**
  );
});

/* ìì²´ ê¸°ë™ í™•ì¸ ë¡œê·¸ */
log('Storage iframe ready. Wait for postMessage() â€¦');
</script>
</body>
</html>
